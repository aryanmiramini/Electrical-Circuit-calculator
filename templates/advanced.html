<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Electrical Circuit Solver</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        h1 {
            margin: 0;
            color: #2c3e50;
        }
        .nav-link {
            text-decoration: none;
            color: #3498db;
            font-weight: 600;
        }
        .nav-link:hover {
            text-decoration: underline;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            background-color: #f8f9fa;
        }
        .tab.active {
            background-color: #fff;
            border-color: #ddd;
            margin-bottom: -1px;
            border-bottom: 1px solid #fff;
        }
        .tab-content {
            padding-top: 20px;
        }
        .panel {
            display: none;
        }
        .panel.active {
            display: block;
        }
        .form-section {
            margin-bottom: 25px;
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .form-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .config-options {
            margin-top: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .resistor-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .resistor-row input {
            flex: 1;
        }
        .add-resistor {
            background-color: #27ae60;
            padding: 8px 12px;
            font-size: 14px;
        }
        .remove-resistor {
            background-color: #e74c3c;
            padding: 8px 12px;
            margin: 0;
        }
        .results {
            margin-top: 30px;
            display: none;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .result-table th, .result-table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: left;
        }
        .result-table th {
            background-color: #f2f2f2;
        }
        .formula-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .error {
            color: #e74c3c;
            padding: 10px;
            background-color: #fadbd8;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }
        .loading {
            text-align: center;
            display: none;
            margin: 20px 0;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3498db;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced Electrical Circuit Solver</h1>
            <a href="/" class="nav-link">Basic Calculator</a>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="dc">DC Circuits</div>
            <div class="tab" data-tab="ac">AC Circuits</div>
        </div>
        
        <div class="tab-content">
            <!-- DC Circuits Panel -->
            <div class="panel active" id="dc-panel">
                <div class="form-section">
                    <h3>DC Circuit Configuration</h3>
                    <div class="form-group">
                        <label for="dc-configuration">Circuit Configuration:</label>
                        <select id="dc-configuration">
                            <option value="series">Series Resistors</option>
                            <option value="parallel">Parallel Resistors</option>
                            <option value="voltage_divider">Voltage Divider</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="dc-voltage">Source Voltage (V):</label>
                        <input type="number" id="dc-voltage" placeholder="Enter voltage in volts" step="0.1">
                    </div>
                    
                    <!-- Configuration specific inputs -->
                    <div class="config-options" id="series-parallel-config">
                        <div id="resistors-container">
                            <div class="resistor-row">
                                <input type="number" class="resistor-input" placeholder="Resistance in Ohms" step="0.1">
                                <button class="remove-resistor">✕</button>
                            </div>
                            <div class="resistor-row">
                                <input type="number" class="resistor-input" placeholder="Resistance in Ohms" step="0.1">
                                <button class="remove-resistor">✕</button>
                            </div>
                        </div>
                        <button class="add-resistor">Add Resistor</button>
                    </div>
                    
                    <div class="config-options" id="voltage-divider-config" style="display: none;">
                        <div class="form-group">
                            <label for="r1-divider">R1 (Ohms):</label>
                            <input type="number" id="r1-divider" placeholder="R1 resistance in Ohms" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="r2-divider">R2 (Ohms):</label>
                            <input type="number" id="r2-divider" placeholder="R2 resistance in Ohms" step="0.1">
                        </div>
                    </div>
                </div>
                
                <button id="solve-dc">Solve Circuit</button>
                
                <div class="loading" id="dc-loading">
                    <div class="spinner"></div>
                    <p>Calculating results...</p>
                </div>
                
                <div class="results" id="dc-results">
                    <h3>Circuit Analysis Results</h3>
                    <div id="dc-results-content"></div>
                    
                    <div class="formula-section">
                        <h4>Formulas Used:</h4>
                        <div id="dc-formulas"></div>
                    </div>
                </div>
                
                <div class="error" id="dc-error"></div>
            </div>
            
            <!-- AC Circuits Panel -->
            <div class="panel" id="ac-panel">
                <div class="form-section">
                    <h3>AC Circuit Configuration</h3>
                    <div class="form-group">
                        <label for="ac-configuration">Circuit Type:</label>
                        <select id="ac-configuration">
                            <option value="rc">RC Circuit</option>
                            <option value="rl">RL Circuit</option>
                            <option value="rlc">RLC Circuit</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ac-voltage">Source Voltage (V RMS):</label>
                        <input type="number" id="ac-voltage" placeholder="Enter voltage in volts" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="ac-frequency">Frequency (Hz):</label>
                        <input type="number" id="ac-frequency" placeholder="Enter frequency in Hz" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="ac-resistance">Resistance (Ohms):</label>
                        <input type="number" id="ac-resistance" placeholder="Enter resistance in Ohms" step="0.1">
                    </div>
                    
                    <div class="form-group" id="capacitance-group">
                        <label for="ac-capacitance">Capacitance (μF):</label>
                        <input type="number" id="ac-capacitance" placeholder="Enter capacitance in microfarads" step="0.001">
                    </div>
                    
                    <div class="form-group" id="inductance-group" style="display: none;">
                        <label for="ac-inductance">Inductance (mH):</label>
                        <input type="number" id="ac-inductance" placeholder="Enter inductance in millihenries" step="0.1">
                    </div>
                </div>
                
                <button id="solve-ac">Solve Circuit</button>
                
                <div class="loading" id="ac-loading">
                    <div class="spinner"></div>
                    <p>Calculating results...</p>
                </div>
                
                <div class="results" id="ac-results">
                    <h3>Circuit Analysis Results</h3>
                    <div id="ac-results-content"></div>
                    
                    <div class="formula-section">
                        <h4>Formulas Used:</h4>
                        <div id="ac-formulas"></div>
                    </div>
                </div>
                
                <div class="error" id="ac-error"></div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tabs functionality
            const tabs = document.querySelectorAll('.tab');
            const panels = document.querySelectorAll('.panel');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetPanel = this.dataset.tab;
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active panel
                    panels.forEach(p => p.classList.remove('active'));
                    if (targetPanel === 'dc') {
                        document.getElementById('dc-panel').classList.add('active');
                    } else {
                        document.getElementById('ac-panel').classList.add('active');
                    }
                });
            });
            
            // DC Configuration change handling
            const dcConfiguration = document.getElementById('dc-configuration');
            const seriesParallelConfig = document.getElementById('series-parallel-config');
            const voltageDividerConfig = document.getElementById('voltage-divider-config');
            
            dcConfiguration.addEventListener('change', function() {
                if (this.value === 'voltage_divider') {
                    seriesParallelConfig.style.display = 'none';
                    voltageDividerConfig.style.display = 'block';
                } else {
                    seriesParallelConfig.style.display = 'block';
                    voltageDividerConfig.style.display = 'none';
                }
            });
            
            // AC Configuration change handling
            const acConfiguration = document.getElementById('ac-configuration');
            const capacitanceGroup = document.getElementById('capacitance-group');
            const inductanceGroup = document.getElementById('inductance-group');
            
            acConfiguration.addEventListener('change', function() {
                if (this.value === 'rc') {
                    capacitanceGroup.style.display = 'block';
                    inductanceGroup.style.display = 'none';
                } else if (this.value === 'rl') {
                    capacitanceGroup.style.display = 'none';
                    inductanceGroup.style.display = 'block';
                } else if (this.value === 'rlc') {
                    capacitanceGroup.style.display = 'block';
                    inductanceGroup.style.display = 'block';
                }
            });
            
            // Add/Remove resistor functionality
            const resistorsContainer = document.getElementById('resistors-container');
            const addResistorButton = document.querySelector('.add-resistor');
            
            addResistorButton.addEventListener('click', function() {
                const resistorRow = document.createElement('div');
                resistorRow.className = 'resistor-row';
                resistorRow.innerHTML = `
                    <input type="number" class="resistor-input" placeholder="Resistance in Ohms" step="0.1">
                    <button class="remove-resistor">✕</button>
                `;
                resistorsContainer.appendChild(resistorRow);
                
                // Add event listener to the new remove button
                const newRemoveButton = resistorRow.querySelector('.remove-resistor');
                newRemoveButton.addEventListener('click', function() {
                    if (resistorsContainer.children.length > 1) {
                        resistorsContainer.removeChild(resistorRow);
                    }
                });
            });
            
            // Initial event listeners for remove buttons
            document.querySelectorAll('.remove-resistor').forEach(button => {
                button.addEventListener('click', function() {
                    if (resistorsContainer.children.length > 1) {
                        resistorsContainer.removeChild(this.parentElement);
                    }
                });
            });
            
            // DC Circuit Solver
            const solveDcButton = document.getElementById('solve-dc');
            const dcResults = document.getElementById('dc-results');
            const dcResultsContent = document.getElementById('dc-results-content');
            const dcFormulas = document.getElementById('dc-formulas');
            const dcError = document.getElementById('dc-error');
            const dcLoading = document.getElementById('dc-loading');
            
            solveDcButton.addEventListener('click', async function() {
                // Hide previous results and errors
                dcResults.style.display = 'none';
                dcError.style.display = 'none';
                dcLoading.style.display = 'block';
                
                try {
                    const configuration = dcConfiguration.value;
                    const voltage = parseFloat(document.getElementById('dc-voltage').value);
                    
                    if (isNaN(voltage)) {
                        throw new Error('Please enter a valid voltage value');
                    }
                    
                    let data = {
                        circuit_type: 'dc',
                        configuration: configuration,
                        voltage_source: voltage
                    };
                    
                    if (configuration === 'series' || configuration === 'parallel') {
                        const resistorInputs = document.querySelectorAll('.resistor-input');
                        const resistances = [];
                        
                        resistorInputs.forEach(input => {
                            const value = parseFloat(input.value);
                            if (!isNaN(value)) {
                                resistances.push(value);
                            }
                        });
                        
                        if (resistances.length < 1) {
                            throw new Error('Please enter at least one resistance value');
                        }
                        
                        data.resistances = resistances;
                    } else if (configuration === 'voltage_divider') {
                        const r1 = parseFloat(document.getElementById('r1-divider').value);
                        const r2 = parseFloat(document.getElementById('r2-divider').value);
                        
                        if (isNaN(r1) || isNaN(r2)) {
                            throw new Error('Please enter valid resistance values for R1 and R2');
                        }
                        
                        data.r1 = r1;
                        data.r2 = r2;
                    }
                    
                    const response = await fetch('/solve_circuit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        // Display results
                        displayDcResults(result, configuration);
                        dcResults.style.display = 'block';
                    } else {
                        throw new Error(result.error || 'An error occurred during calculation');
                    }
                } catch (error) {
                    dcError.textContent = error.message;
                    dcError.style.display = 'block';
                } finally {
                    dcLoading.style.display = 'none';
                }
            });
            
            function displayDcResults(data, configuration) {
                const results = data.results;
                const formulas = data.formulas;
                
                let resultsHtml = '<table class="result-table">';
                
                if (configuration === 'series') {
                    resultsHtml += `
                        <tr><th>Total Resistance</th><td>${results.total_resistance.toFixed(3)} Ω</td></tr>
                        <tr><th>Circuit Current</th><td>${results.current.toFixed(3)} A</td></tr>
                        <tr><th>Total Power</th><td>${results.total_power.toFixed(3)} W</td></tr>
                    `;
                    
                    resultsHtml += '</table><h4>Individual Components:</h4><table class="result-table">';
                    resultsHtml += '<tr><th>Component</th><th>Resistance (Ω)</th><th>Voltage (V)</th><th>Power (W)</th></tr>';
                    
                    for (let i = 0; i < results.voltage_drops.length; i++) {
                        resultsHtml += `
                            <tr>
                                <td>R${i+1}</td>
                                <td>${results.resistances ? results.resistances[i].toFixed(3) : '—'}</td>
                                <td>${results.voltage_drops[i].toFixed(3)}</td>
                                <td>${results.powers[i].toFixed(3)}</td>
                            </tr>
                        `;
                    }
                } else if (configuration === 'parallel') {
                    resultsHtml += `
                        <tr><th>Total Resistance</th><td>${results.total_resistance.toFixed(3)} Ω</td></tr>
                        <tr><th>Total Current</th><td>${results.total_current.toFixed(3)} A</td></tr>
                        <tr><th>Total Power</th><td>${results.total_power.toFixed(3)} W</td></tr>
                    `;
                    
                    resultsHtml += '</table><h4>Individual Components:</h4><table class="result-table">';
                    resultsHtml += '<tr><th>Component</th><th>Resistance (Ω)</th><th>Current (A)</th><th>Power (W)</th></tr>';
                    
                    for (let i = 0; i < results.branch_currents.length; i++) {
                        resultsHtml += `
                            <tr>
                                <td>R${i+1}</td>
                                <td>${results.resistances ? results.resistances[i].toFixed(3) : '—'}</td>
                                <td>${results.branch_currents[i].toFixed(3)}</td>
                                <td>${results.powers[i].toFixed(3)}</td>
                            </tr>
                        `;
                    }
                } else if (configuration === 'voltage_divider') {
                    resultsHtml += `
                        <tr><th>Input Voltage</th><td>${document.getElementById('dc-voltage').value} V</td></tr>
                        <tr><th>Output Voltage (across R2)</th><td>${results.output_voltage.toFixed(3)} V</td></tr>
                        <tr><th>Current</th><td>${results.current.toFixed(3)} A</td></tr>
                        <tr><th>Total Resistance</th><td>${results.total_resistance.toFixed(3)} Ω</td></tr>
                        <tr><th>Power through R1</th><td>${results.power_r1.toFixed(3)} W</td></tr>
                        <tr><th>Power through R2</th><td>${results.power_r2.toFixed(3)} W</td></tr>
                        <tr><th>Total Power</th><td>${results.total_power.toFixed(3)} W</td></tr>
                    `;
                }
                
                resultsHtml += '</table>';
                dcResultsContent.innerHTML = resultsHtml;
                
                // Display formulas
                let formulasHtml = '<ul>';
                for (const key in formulas) {
                    formulasHtml += `<li><strong>${key}:</strong> ${formulas[key]}</li>`;
                }
                formulasHtml += '</ul>';
                dcFormulas.innerHTML = formulasHtml;
            }
            
            // AC Circuit Solver
            const solveAcButton = document.getElementById('solve-ac');
            const acResults = document.getElementById('ac-results');
            const acResultsContent = document.getElementById('ac-results-content');
            const acFormulas = document.getElementById('ac-formulas');
            const acError = document.getElementById('ac-error');
            const acLoading = document.getElementById('ac-loading');
            
            solveAcButton.addEventListener('click', async function() {
                // Hide previous results and errors
                acResults.style.display = 'none';
                acError.style.display = 'none';
                acLoading.style.display = 'block';
                
                try {
                    const configuration = acConfiguration.value;
                    const voltage = parseFloat(document.getElementById('ac-voltage').value);
                    const frequency = parseFloat(document.getElementById('ac-frequency').value);
                    const resistance = parseFloat(document.getElementById('ac-resistance').value);
                    
                    if (isNaN(voltage) || isNaN(frequency) || isNaN(resistance)) {
                        throw new Error('Please enter valid values for voltage, frequency and resistance');
                    }
                    
                    if (frequency <= 0) {
                        throw new Error('Frequency must be greater than 0');
                    }
                    
                    let data = {
                        circuit_type: 'ac',
                        configuration: configuration,
                        voltage_source: voltage,
                        frequency: frequency,
                        resistance: resistance
                    };
                    
                    if (configuration === 'rc' || configuration === 'rlc') {
                        const capacitance = parseFloat(document.getElementById('ac-capacitance').value);
                        
                        if (isNaN(capacitance) || capacitance <= 0) {
                            throw new Error('Please enter a valid capacitance value greater than 0');
                        }
                        
                        data.capacitance = capacitance;
                    }
                    
                    if (configuration === 'rl' || configuration === 'rlc') {
                        const inductance = parseFloat(document.getElementById('ac-inductance').value);
                        
                        if (isNaN(inductance) || inductance <= 0) {
                            throw new Error('Please enter a valid inductance value greater than 0');
                        }
                        
                        data.inductance = inductance;
                    }
                    
                    const response = await fetch('/solve_circuit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        // Display results
                        displayAcResults(result, configuration);
                        acResults.style.display = 'block';
                    } else {
                        throw new Error(result.error || 'An error occurred during calculation');
                    }
                } catch (error) {
                    acError.textContent = error.message;
                    acError.style.display = 'block';
                } finally {
                    acLoading.style.display = 'none';
                }
            });
            
            function displayAcResults(data, configuration) {
                const results = data.results;
                const formulas = data.formulas;
                
                let resultsHtml = '<table class="result-table">';
                
                resultsHtml += `
                    <tr><th>Impedance (Z)</th><td>${results.impedance.toFixed(3)} Ω</td></tr>
                    <tr><th>Phase Angle</th><td>${results.phase_angle.toFixed(2)}°</td></tr>
                    <tr><th>Current</th><td>${results.current.toFixed(3)} A</td></tr>
                    <tr><th>Power Factor</th><td>${results.power_factor.toFixed(3)}</td></tr>
                    <tr><th>Real Power (P)</th><td>${results.real_power.toFixed(3)} W</td></tr>
                    <tr><th>Reactive Power (Q)</th><td>${results.reactive_power.toFixed(3)} VAR</td></tr>
                    <tr><th>Apparent Power (S)</th><td>${results.apparent_power.toFixed(3)} VA</td></tr>
                `;
                
                if (configuration === 'rc' || configuration === 'rl') {
                    resultsHtml += `<tr><th>Time Constant (τ)</th><td>${results.time_constant.toFixed(6)} s</td></tr>`;
                }
                
                if (configuration === 'rc') {
                    resultsHtml += `
                        <tr><th>Voltage across Resistor</th><td>${results.voltage_r.toFixed(3)} V</td></tr>
                        <tr><th>Voltage across Capacitor</th><td>${results.voltage_c.toFixed(3)} V</td></tr>
                    `;
                } else if (configuration === 'rl') {
                    resultsHtml += `
                        <tr><th>Voltage across Resistor</th><td>${results.voltage_r.toFixed(3)} V</td></tr>
                        <tr><th>Voltage across Inductor</th><td>${results.voltage_l.toFixed(3)} V</td></tr>
                    `;
                } else if (configuration === 'rlc') {
                    resultsHtml += `
                        <tr><th>Voltage across Resistor</th><td>${results.voltage_r.toFixed(3)} V</td></tr>
                        <tr><th>Voltage across Inductor</th><td>${results.voltage_l.toFixed(3)} V</td></tr>
                        <tr><th>Voltage across Capacitor</th><td>${results.voltage_c.toFixed(3)} V</td></tr>
                        <tr><th>Resonant Frequency</th><td>${results.resonant_frequency.toFixed(3)} Hz</td></tr>
                    `;
                }
                
                resultsHtml += '</table>';
                acResultsContent.innerHTML = resultsHtml;
                
                // Display formulas
                let formulasHtml = '<ul>';
                for (const key in formulas) {
                    formulasHtml += `<li><strong>${key}:</strong> ${formulas[key]}</li>`;
                }
                formulasHtml += '</ul>';
                acFormulas.innerHTML = formulasHtml;
            }
        });
    </script>
</body>
</html> 